<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eldesiz Toplama Macerasƒ± - 2. Sƒ±nƒ±f</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* ------------------ TEMEL STƒ∞LLER (G√ñRSEL D√úZENLEMELER) ------------------ */
        body {
            font-family: 'Fredoka', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f7f9fc;
            background-image: linear-gradient(to right, rgba(199, 215, 237, 0.3) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(199, 215, 237, 0.3) 1px, transparent 1px);
            background-size: 20px 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .container {
            background-color: #ffffff;
            padding: 35px; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), 0 5px 15px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 700px;
            text-align: center;
            z-index: 10;
        }

        .screen { display: none;
        }
        .screen.active { display: block;
        }
        
        /* G√úNCEL: Header alanƒ± kutular i√ßin esnek hale getirildi */
        .header { 
            display: flex;
            justify-content: space-between; 
            margin-bottom: 25px; 
            gap: 10px; /* Kutular arasƒ±na bo≈üluk */
        }
        
        /* YENƒ∞ STƒ∞L: Header bilgileri i√ßin renkli kutucuklar */
        .header-item {
            flex-grow: 1;
            padding: 10px 5px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            color: #334455;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* Renk Tanƒ±mlamalarƒ± */
        #playerNameDisplay { background-color: #e7f3ff;
            border: 2px solid #a8c8e3; color: #2980b9; } /* Mavi */
        #scoreDisplay { background-color: #e7fff0;
            border: 2px solid #98e3b5; color: #2ecc71; } /* Ye≈üil */
        #timerDisplay { background-color: #fff0e7;
            border: 2px solid #e3a898; color: #e67e22; } /* Turuncu */


        .player-list-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out; 
        }
        .player-list-wrapper.visible {
            max-height: 300px;
            margin-bottom: 25px;
        }

        .player-list { max-height: 250px; overflow-y: auto;
        }
        .player-list button { 
            display: block;
            width: 90%; 
            margin: 10px auto; 
            padding: 14px; 
            background-color: #4BB778; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 19px;
            transition: background-color 0.3s, transform 0.1s; 
        }
        .player-list button:hover { background-color: #3e9e67; transform: translateY(-2px);
        }

        .container button {
            transition: all 0.3s ease;
        }

        #togglePlayerListBtn {
            background-color: #3498db !important;
            color: white;
            padding: 16px 35px;
            font-size: 1.3em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.4);
        }
        #togglePlayerListBtn:hover {
            background-color: #2980b9 !important;
            box-shadow: 0 6px 8px rgba(52, 152, 219, 0.5);
        }
        #togglePlayerListBtn.clicked { 
             background-color: #e74c3c !important;
            box-shadow: 0 4px 6px rgba(231, 76, 60, 0.4);
        }

        #highScores { margin-top: 35px;
            border-top: 2px solid #e0e0e0; padding-top: 20px; }
        #highScores h3 { color: #334455;
        }
        
        /* KAYDIRMALI SKOR Lƒ∞STESƒ∞ ƒ∞√áƒ∞N STƒ∞L */
        #highScoresContent {
            max-height: 250px; 
            overflow-y: auto; 
            padding-right: 5px; 
        }
        
        .score-item { 
            display: flex;
            justify-content: space-between; 
            padding: 10px 15px; 
            margin-bottom: 5px;
            background-color: #fcfcfc;
            border-radius: 8px;
            border: 1px solid #eee;
            font-weight: 400;
        }

        .score-item > span:last-child {
            display: flex;
            align-items: center;
        }
        
        /* ################# ƒ∞≈ûLEM ALANI STƒ∞LLERƒ∞ ################# */

        .operation-container {
            display: grid;
            grid-template-columns: 30px 140px;
            justify-content: center;
            align-items: center;
            font-size: 3.2em; 
            font-weight: 600;
            margin: 15px 0 10px 0; 
            min-height: 140px;
        }

        #currentOperationGrid {
            grid-column: 2;
            display: flex;
            flex-direction: column;
            align-items: flex-end; 
        }

        .op-number {
            line-height: 0.95;
            padding-right: 8px;
            color: #2c3e50;
        }

        .op-line-separator {
            grid-column: 1 / span 2;
            width: 100%;
            border-bottom: 2px solid #334455; 
            margin-top: 5px;
        }

        #opPlusContainer {
            grid-column: 1;
            line-height: 1; 
            align-self: end; 
            padding-bottom: 5px; 
            font-size: 1em;
            color: #3498db; 
        }

        /* ################# SONU√á B√ñLGESƒ∞ STƒ∞LLERƒ∞ ################# */

        .result-zone { 
            display: flex;
            justify-content: center; 
            margin-top: 10px; 
            margin-bottom: 15px;
        }
        
        .result-digit { 
            width: 60px;
            height: 70px;
            border: 2px dashed #aebcce;
            margin: 0 8px;
            display: flex; 
            justify-content: center;
            align-items: center; 
            font-size: 2.8em; 
            color: #334455;
            background-color: #fcfcfc; 
            border-radius: 8px; 
            transition: all 0.2s;
        }
        .result-digit:hover {
            background-color: #f0f0f0;
            border-color: #3498db;
        }
        
        /* ################# PALET STƒ∞LLERƒ∞ ################# */

        .number-palette { 
            display: flex;
            justify-content: center; 
            gap: 6px; 
            padding: 4px 0;
            border-top: 2px solid #e0e0e0;
        }
        
        .draggable-number { 
            width: 50px;
            height: 50px; 
            line-height: 50px; 
            border-radius: 50%; 
            font-size: 1.8em; 
            font-weight: 600; 
            cursor: grab; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
            color: white; 
        }
        .draggable-number:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
        }

        .top-row {
             border-top: 2px solid #e0e0e0;
        }
        .bottom-row {
             border-top: none;
        }

        /* Renk Paleti (0'dan 9'a) */
        .c0 { background-color: #8D33FF;
        } 
        .c1 { background-color: #FF5733;
        } 
        .c2 { background-color: #FFC300;
        } 
        .c3 { background-color: #33FF57;
        } 
        .c4 { background-color: #3357FF;
        } 
        .c5 { background-color: #FF33A1;
        } 
        .c6 { background-color: #33FFF6;
        } 
        .c7 { background-color: #FF8333;
        } 
        .c8 { background-color: #A1A1A1;
        } 
        .c9 { background-color: #990099;
        } 

        #feedback { 
            min-height: 30px;
            font-size: 1.4em; 
            font-weight: 700; 
            margin: 10px 0; 
        }
        
        /* ################# KONFETI STƒ∞Lƒ∞ ################# */
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 20px;
            background: #ff0; 
            opacity: 0;
            animation: confetti-fall 3s linear forwards;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(0) rotateZ(0);
                opacity: 1; }
            100% { transform: translateY(100vh) rotateZ(720deg);
                opacity: 0; }
        }
        /* ################# √ñZEL MOBƒ∞L UYUMLULUK ################# */
        @media (max-width: 450px) {
            
            .container {
                padding: 15px 5px;
            }
            body {
                padding: 10px;
            }

            .header-item {
                font-size: 0.8em;
                padding: 5px 2px;
            }

            .result-digit { 
                width: 45px;
                height: 55px;
                font-size: 1.8em;
                margin: 0 4px;
            }

            .number-palette { 
                gap: 4px;
                padding: 4px 0;
            }
            
            .draggable-number { 
                width: 38px;
                height: 38px; 
                line-height: 38px; 
                font-size: 1.4em; 
            }
            /* Kaydƒ±rmalƒ± alanƒ±n mobil uyumluluƒüu */
            #highScoresContent {
                max-height: 180px; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div id="splashScreen" class="screen active">
            <h2>Eldesiz Toplama Macerasƒ±</h2>
            <p style="font-size: 1.1em; color: #555;">Oyuna ba≈ülamak i√ßin adƒ±nƒ±zƒ± se√ßin ve bireysel ≈üifrenizi girin.</p>

            <button id="togglePlayerListBtn" onclick="togglePlayerList()">Adƒ±nƒ±zƒ± Se√ßin</button>
     
            <div class="player-list-wrapper" id="playerListWrapper">
                <div class="player-list" id="playerListContainer">
                    </div>
            </div>

            <button onclick="clearAllScoresWithPassword()" style="
                background-color: #e74c3c; 
                color: white;
                padding: 12px 25px;
                font-size: 1em;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                margin-top: 20px;
                box-shadow: 0 3px 5px rgba(231, 76, 60, 0.3);
            ">T√ºm Skorlarƒ± Sil (Y√∂netici)</button>
            
            <div id="highScores">
                <h3>üèÜ En ƒ∞yi Skorlar</h3>
                <div id="highScoresContent">
                    </div>
            </div>
        </div>

        <div id="gameScreen" class="screen">
            <div class="header">
          
                <span id="playerNameDisplay" class="header-item">Oyuncu: -</span>
                <span id="scoreDisplay" class="header-item">Puan: 0</span>
                <span id="timerDisplay" class="header-item">S√ºre: 120</span>
            </div>

            <div class="operation-container">
                <div id="opPlusContainer"></div> 
          
                <div id="currentOperationGrid"></div>
                <div class="op-line-separator"></div> 
            </div>

            <div class="result-zone">
                <div class="result-digit" data-place="tens" ondrop="drop(event, this)" ondragover="allowDrop(event)">?</div>
         
                <div class="result-digit" data-place="ones" ondrop="drop(event, this)" ondragover="allowDrop(event)">?</div>
        
            </div>
            
            <div id="feedback"></div>

            <div class="number-palette top-row" id="numberPaletteTop"></div>
            <div class="number-palette bottom-row" id="numberPaletteBottom"></div>
        </div>

     
        <div id="gameOverScreen" class="screen">
            <h2>Oyun Bitti!</h2>
          
            <p id="finalScoreText" style="font-size: 1.2em;
                font-weight: 600; color: #34495e;"></p>
            <button onclick="window.location.reload()" style="
                background-color: #2ecc71;
                color: white;
                padding: 15px 30px;
                font-size: 1.2em;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                margin-top: 15px;
                box-shadow: 0 4px 6px rgba(46, 204, 113, 0.4);
            ">Yeniden Ba≈üla</button>
        </div>

    </div>

    <script>
        // ------------------ JAVASCRIPT KODLARI ------------------
        
        // Y√ñNETƒ∞Cƒ∞ ≈ûƒ∞FRESƒ∞
        const ADMIN_PASSWORD = "ogretmen2024"; 
        const GAME_DURATION = 120; 

        // ################## √ñƒûRENCƒ∞ ADLARI VE ≈ûƒ∞FRELERƒ∞ ##################
       
        const STUDENT_PASSWORDS = {
            "AHMET EFE AYVAZ": "4910",
            "ALƒ∞ ARAS AYYILDIZ": "5335",
            "ALƒ∞ ASAF G√úRB√úZ": "4771",
            "ALYA DEMƒ∞RAL": "2041",
            "ASEL LENA AYYILDIZ": "2441",
            "ASIM Mƒ∞RA√á KARA": 
            "2766",
       
            "AYB√úKE √ñZKAN": "4850",
            "BERAT ALƒ∞ AKDEMƒ∞R": "2532",
            "BET√úL SENA G√úNG√ñR": "2274",
            "DERƒ∞N DURU √áAL": "5010",
            "Dƒ∞DEM SOYLU": "4207",
            "EMƒ∞R R√úZGAR G√ñLE≈û": "5822",
     
            "ESƒ∞LA Yƒ∞ƒûƒ∞T": "2644",
     
            "EYMEN ARAS PULATKAN": "1722",
            "EYMEN YAYLACIK": "2425",
            "FATMA Hƒ∞RA ASLAN": "2310",
            "FEYZA EMƒ∞NE ALTUN": "5142",
            "HAMZA KAƒûAN √ñZTA≈û": "2486",
            
            "HATƒ∞CE √áALƒ∞MLƒ∞": "1352",
            "HELƒ∞N ADA": "2661",
   
            "H√úSNE SERRA CEREN": "5303",
            "ƒ∞MRAN YAZICI": "2832",
            "Mƒ∞RA√á √ñZ√áELEBƒ∞": "3552",
            "MUSAB Cƒ∞HAT KILI√á": "2841",
            "Nƒ∞SANUR Fƒ∞Lƒ∞Z": "1234",
         
            "√ñMER ASAF G√úNG√ñR": "2274",
            "SAƒ∞D HAMZA ASLAN": "2272",
 
            "Sƒ∞NAN BARAN": "4840",
            "TUANA T√úRK DERƒ∞N √áETƒ∞N": "1961",
            "UMUT ARAS KUTLU": "2216",
            "Yƒ∞ƒûƒ∞T ALƒ∞ BENLƒ∞": "2559",
            "Yƒ∞ƒûƒ∞T ASAF ƒ∞≈ûSEVER": "4888",
   
            "YUSUF BERAT TANRIVERDƒ∞": "4682",
           
            "YUSUF BOZDOƒûAN": "4810",
            "YUSUF EYMEN √áINAR": "5046",
            "ZEYNEB MERYEM TAHƒ∞ROƒûLU": "4422",
            "ZEYNEP AKSOY": "2414",
            "Z√úMRA BELƒ∞Z YILDIRIM": "4949"
    
        };
        // ###############################################################

        const STUDENT_NAMES = Object.keys(STUDENT_PASSWORDS);
        const INITIAL_PLAYERS = [...STUDENT_NAMES, "√ñƒüretmen"];
        const generateUniqueId = () => Date.now().toString(36) + Math.random().toString(36).substring(2);

        let currentScore = 0;
        let timeLeft = GAME_DURATION;
        let timerInterval;
        let currentPlayer = null;
        let currentAnswer = null;
        let resultDigits = { ones: null, tens: null };
        const splashScreen = document.getElementById('splashScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const playerListContainer = document.getElementById('playerListContainer');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const feedbackDisplay = document.getElementById('feedback');
        const opPlusContainer = document.getElementById('opPlusContainer');
        const currentOperationGrid = document.getElementById('currentOperationGrid');
        const playerListWrapper = document.getElementById('playerListWrapper');
        const numberPalette = document.getElementById('numberPalette');
        const resultDigitsElements = document.querySelectorAll('.result-digit');
        let currentDragElement = null;
        // ------------------ LOCAL STORAGE Y√ñNETƒ∞Mƒ∞ ------------------
        function getHighScores() {
            try {
                const scores = JSON.parse(localStorage.getItem('toplamaScores'));
                return Array.isArray(scores) ? scores : [];
            } catch (e) { return [];
            }
        }

        function saveScore(player, score) {
            const scores = getHighScores();
            const newScoreEntry = { 
                id: generateUniqueId(),
                player: player, 
                score: score 
            };
            scores.push(newScoreEntry);
            
            scores.sort((a, b) => b.score - a.score); 
            
            localStorage.setItem('toplamaScores', JSON.stringify(scores));
            renderHighScores();
        }

        // ------------------ SKOR Sƒ∞LME FONKSƒ∞YONLARI ------------------
        
        function deleteSingleScoreWithPassword(scoreId, playerName) {
            const enteredPassword = prompt(`${playerName} oyuncusunun kaydƒ±nƒ± silmek i√ßin Y√ñNETƒ∞Cƒ∞ ≈üifresini girin:`);
            if (enteredPassword === ADMIN_PASSWORD) {
                let scores = getHighScores();
                const updatedScores = scores.filter(s => 
                    s.id !== scoreId 
                );
                localStorage.setItem('toplamaScores', JSON.stringify(updatedScores));
                renderHighScores();
                alert(`${playerName} oyuncusunun kaydƒ± silindi.`);

            } else if (enteredPassword !== null) {
                alert('Hata! Girilen ≈üifre yanlƒ±≈ü.');
            }
        }
        
        function clearAllScoresWithPassword() {
            const enteredPassword = prompt("T√ºm Skorlarƒ± Silmek ƒ∞√ßin Y√ñNETƒ∞Cƒ∞ ≈üifresini girin:");
            if (enteredPassword === ADMIN_PASSWORD) {
                localStorage.removeItem('toplamaScores');
                renderHighScores();
                alert('Tebrikler! T√ºm Skorlar Ba≈üarƒ±yla Sƒ±fƒ±rlandƒ±.');
            } else if (enteredPassword !== null) {
                alert('Hata! Girilen ≈üifre yanlƒ±≈ü.');
            }
        }
        
        // ------------------ OYUN AKI≈ûI FONKSƒ∞YONLARI ------------------

        function togglePlayerList() {
            playerListWrapper.classList.toggle('visible');
            const btn = document.getElementById('togglePlayerListBtn');
            
            if (playerListWrapper.classList.contains('visible')) {
                btn.textContent = 'Listeyi Gizle';
                btn.classList.add('clicked'); 
            } else {
                btn.textContent = 'Adƒ±nƒ±zƒ± Se√ßin';
                btn.classList.remove('clicked'); 
            }
        }
        
        function checkPasswordAndStartGame(player) {
            let requiredPassword = null;
            if (player === "√ñƒüretmen") {
                requiredPassword = ADMIN_PASSWORD;
            } else if (STUDENT_PASSWORDS[player]) {
                requiredPassword = STUDENT_PASSWORDS[player];
            } else {
                alert('Hata: Oyuncu kaydƒ± bulunamadƒ±.');
                return; 
            }

            const enteredPassword = prompt(`${player} adƒ±yla ba≈ülamak i√ßin ≈üifrenizi girin:`);
            if (enteredPassword === null) {
                return;
            }
            
            if (enteredPassword === requiredPassword) {
                startGame(player);
            } else {
                alert('Hata: Girilen ≈üifre yanlƒ±≈ü. L√ºtfen tekrar deneyin.');
            }
        }

        function startGame(player) {
            currentPlayer = player;
            currentScore = 0;
            timeLeft = GAME_DURATION;
            splashScreen.classList.remove('active');
            gameScreen.classList.add('active');
            document.getElementById('playerNameDisplay').textContent = `üë§ Oyuncu: ${currentPlayer}`;
            updateDisplay();
            generateNewOperation();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `‚è≥ S√ºre: ${timeLeft}`;
                if (timeLeft <= 0) {
                  
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            gameScreen.classList.remove('active');
            gameOverScreen.classList.add('active');
            clearInterval(timerInterval);
            document.getElementById('finalScoreText').textContent = `${currentPlayer}, Toplam Puanƒ±n: ${currentScore}`;
            saveScore(currentPlayer, currentScore);
        }

        function updateDisplay() {
            scoreDisplay.textContent = `‚≠ê Puan: ${currentScore}`;
        }

        function generateRandomNonCarrying() {
            let numbers = [];
            let numCount = Math.random() < 0.5 ? 2 : 3;
            let sumOnes = 0;
            let sumTens = 0;
            for (let i = 0; i < numCount; i++) {
                let ones, tens;
                ones = Math.floor(Math.random() * (10 - sumOnes));
                sumOnes += ones;
                tens = Math.floor(Math.random() * (10 - sumTens));
                sumTens += tens;
                numbers.push(tens * 10 + ones);
            }
            
            if (numbers.every(n => n === 0)) return generateRandomNonCarrying();
            if (sumTens === 0 && sumOnes < 5) {
                 return generateRandomNonCarrying();
            }

            currentAnswer = sumTens * 10 + sumOnes;
            return { numbers: numbers, sum: currentAnswer };
        }

        function generateNewOperation() {
            const operationData = generateRandomNonCarrying();
            const numbers = operationData.numbers;
            currentAnswer = operationData.sum;
            
            let numHTML = '';
            numbers.forEach(num => {
                numHTML += `<div class="op-number">${num}</div>`;
            });
            currentOperationGrid.innerHTML = numHTML;

            opPlusContainer.innerHTML = '+';

            resultDigitsElements.forEach(el => {
                el.textContent = '?';
                el.className = 'result-digit';
            });
            resultDigits = { ones: null, tens: null };
            feedbackDisplay.textContent = '';
        }
        
        const confettiColors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
        function launchConfetti() {
            const pieces = 50;
            for (let i = 0; i < pieces; i++) {
                const piece = document.createElement('div');
                piece.classList.add('confetti-piece');
                
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.top = Math.random() * 50 + '%';
                
                piece.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                piece.style.width = Math.random() * 10 + 5 + 'px';
                piece.style.height = Math.random() * 20 + 10 + 'px';
                piece.style.animationDuration = (Math.random() * 2 + 1) + 's';
                
                document.body.appendChild(piece);
                piece.addEventListener('animationend', () => {
                    piece.remove();
                });
            }
        }

        function allowDrop(ev) { ev.preventDefault();
        }
        function drag(ev) { ev.dataTransfer.setData("value", ev.target.getAttribute('data-value')); ev.dataTransfer.setData("color", ev.target.getAttribute('data-color-class'));
        }
        function drop(ev, targetElement) {
            ev.preventDefault();
            const value = ev.dataTransfer.getData("value");
            const colorClass = ev.dataTransfer.getData("color");
            if (value && colorClass) { handleDrop(targetElement, value, colorClass);
            }
        }
        
        function touchStart(ev) {
            if (ev.touches.length === 1 && ev.target.classList.contains('draggable-number')) {
                currentDragElement = ev.target;
                currentDragElement.style.position = 'absolute';
                currentDragElement.style.zIndex = '1000';
                touchMove(ev); 
            }
        }

        function touchMove(ev) {
            if (currentDragElement) {
                ev.preventDefault();
                const touch = ev.touches[0];
                currentDragElement.style.left = touch.clientX - (currentDragElement.offsetWidth / 2) + 'px';
                currentDragElement.style.top = touch.clientY - (currentDragElement.offsetHeight / 2) + 'px';
            }
        }

        function touchEnd(ev) {
            if (currentDragElement) {
                ev.preventDefault();
                const touch = ev.changedTouches[0];
                
                // 1. S√ºr√ºklenen elementi ge√ßici olarak gizle
                currentDragElement.style.display = 'none';
                // 2. Gizlenen elementin altƒ±ndaki hedefi bul
                const target = document.elementFromPoint(touch.clientX, touch.clientY);
                // 3. S√ºr√ºklenen elementi tekrar g√∂ster
                currentDragElement.style.display = 'block';
                // 4. Hedef bir sonu√ß hanesi mi kontrol et (result-digit) ve bƒ±rakma i≈ülemini ger√ßekle≈ütir
                if (target && target.classList.contains('result-digit')) {
                    handleDrop(target, currentDragElement.getAttribute('data-value'), currentDragElement.getAttribute('data-color-class'));
                }

                // Stilleri sƒ±fƒ±rla ve dragging i≈ülemini bitir
                currentDragElement.style.position = 'relative';
                currentDragElement.style.left = '0';
                currentDragElement.style.top = '0';
                currentDragElement.style.zIndex = '1';
                currentDragElement = null;
            }
        }
        
        function handleDrop(targetElement, value, colorClass) {
            const place = targetElement.getAttribute('data-place');
            targetElement.textContent = value;
            targetElement.className = `result-digit ${colorClass}`;
            resultDigits[place] = parseInt(value);
            checkAnswer();
        }

        function checkAnswer() {
            const { ones, tens } = resultDigits;
            if (currentAnswer <= 9) {
                if (ones !== null) {
                    if (ones === currentAnswer) {
                        handleCorrectAnswer();
                        return;
                    } else if (tens !== null && (tens !== 0 || currentAnswer !== ones)) {
                        handleWrongAnswer();
                        return;
                    }
                }
            } 
            else {
                if (ones !== null && tens !== null) {
                    const guessedAnswer = (tens * 10) + ones;
                    if (guessedAnswer === currentAnswer) {
                        handleCorrectAnswer();
                    } else {
                        handleWrongAnswer();
                    }
                }
            }
        }

        function handleCorrectAnswer() {
    currentScore += 10; // Yeni: Her doƒüru cevap 10 puan
    updateDisplay();
    launchConfetti(); 
    feedbackDisplay.style.color = '#2ecc71'; 
    feedbackDisplay.textContent = 'Aferin! üåü (+10 Puan) Yeni ƒ∞≈ülem Geliyor...';
    setTimeout(() => { generateNewOperation(); }, 1500);
}

function handleWrongAnswer() {
    currentScore = Math.max(0, currentScore - 5); // Yeni: Her yanlƒ±≈ü cevap -5 puan, puan 0'ƒ±n altƒ±na d√º≈ümez
    updateDisplay(); // Puanƒ± hemen g√ºncelliyoruz
    
    feedbackDisplay.style.color = '#e74c3c';
    feedbackDisplay.textContent = 'Yanlƒ±≈ü yaptƒ±n! (-5 Puan) Yeniden dene. ü§î';
    
    // Sonu√ß hanelerini sƒ±fƒ±rlama i≈ülemi (Bu kƒ±sƒ±m aynƒ± kalmƒ±≈ütƒ±r)
    resultDigitsElements.forEach(el => {
        el.textContent = '?';
        el.className = 'result-digit';
    });
    resultDigits = { ones: null, tens: null };
}

        // ------------------ ƒ∞LK Y√úKLEME VE RENDER ------------------
        
        function renderPlayerList() {
            const scores = getHighScores();
            // Hem ba≈ülangƒ±√ß oyuncularƒ±nƒ± hem de skorlarda adƒ± ge√ßenleri tekil (unique) olarak birle≈ütir
            let players = [...new Set([...INITIAL_PLAYERS, ...scores.map(s => s.player)])]; 
            
            if (playerListContainer) {
                playerListContainer.innerHTML = players.map(name => 
                    `<button onclick="checkPasswordAndStartGame('${name}')">${name}</button>`
                ).join('');
            }
        }

        function renderHighScores() {
            const scores = getHighScores();
            // Sorun yaratan ve tek satƒ±rda olmasƒ± gereken template literal d√ºzeltildi.
            const scoreHtml = scores.map((s, index) => {
                const deleteButton = `<button onclick="deleteSingleScoreWithPassword('${s.id}', '${s.player}')" style="background: #e74c3c; color: white; border: none; border-radius: 6px; padding: 4px 8px; margin-left: 12px; cursor: pointer; font-size: 0.9em; line-height: 1.2;">üóëÔ∏è Sil</button>`;
                return `<div class="score-item"><span>${index + 1}. ${s.player}</span><span>${s.score}${deleteButton}</span></div>`; 
            }).join('');
            
            // SKOR Y√úKLEME ALANI
            const highScoresContent = document.getElementById('highScoresContent');

            if (highScoresContent) {
                 highScoresContent.innerHTML = scoreHtml ||
                    '<p style="margin-top: 15px; color: #777;">Hen√ºz skor yok. ƒ∞lk sen oyna!</p>';
            }
        }
        
        function renderNumberPalette() {
            let htmlTop = '';
            let htmlBottom = '';
            const colorClasses = ['c0', 'c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9'];
            for (let i = 0; i <= 9; i++) {
                const numberHtml = `
                    <div 
                        class="draggable-number ${colorClasses[i]}" 
                        draggable="true" 
                        data-value="${i}" 
                        data-color-class="${colorClasses[i]}"
                        ondragstart="drag(event)"
                        ondragover="allowDrop(event)"
                        ondrop="drop(event, this)"
                        ontouchstart="touchStart(event)"
                        ontouchmove="touchMove(event)"
                        ontouchend="touchEnd(event)">
                        ${i}
                    </div>
                `;
                // 0'dan 4'e √ºst satƒ±r
                if (i <= 4) {
                    htmlTop += numberHtml;
                } 
                // 5'ten 9'a alt satƒ±r
                else {
                    htmlBottom += numberHtml;
                }
            }
            
            // ID'lere yerle≈ütirme
            const numberPaletteTop = document.getElementById('numberPaletteTop');
            const numberPaletteBottom = document.getElementById('numberPaletteBottom');

            if (numberPaletteTop) {
                numberPaletteTop.innerHTML = htmlTop;
            }
            if (numberPaletteBottom) {
                numberPaletteBottom.innerHTML = htmlBottom;
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            renderPlayerList(); // Bu fonksiyon √∂ƒürenci listesini y√ºkl√ºyor
            renderHighScores();
            renderNumberPalette();
            splashScreen.classList.add('active'); 
        });
    </script>
</body>
</html>

