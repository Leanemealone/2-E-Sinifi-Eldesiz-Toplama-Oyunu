<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eldesiz Toplama MacerasÄ± - 2. SÄ±nÄ±f</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* ------------------ TEMEL STÄ°LLER (GÃ–RSEL DÃœZENLEMELER) ------------------ */
        body {
            font-family: 'Fredoka', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f7f9fc;
            background-image: linear-gradient(to right, rgba(199, 215, 237, 0.3) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(199, 215, 237, 0.3) 1px, transparent 1px);
            background-size: 20px 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .container {
            background-color: #ffffff;
            padding: 35px; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), 0 5px 15px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 700px;
            text-align: center;
            z-index: 10;
        }

        .screen { display: none;
        }
        .screen.active { display: block;
        }
        
        /* GÃœNCEL: Header alanÄ± kutular iÃ§in esnek hale getirildi */
        .header { 
            display: flex;
            justify-content: space-between; 
            margin-bottom: 25px; 
            gap: 10px; /* Kutular arasÄ±na boÅŸluk */
        }
        
        /* YENÄ° STÄ°L: Header bilgileri iÃ§in renkli kutucuklar */
        .header-item {
            flex-grow: 1;
            padding: 10px 5px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            color: #334455;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* Renk TanÄ±mlamalarÄ± */
        #playerNameDisplay { background-color: #e7f3ff;
            border: 2px solid #a8c8e3; color: #2980b9; } /* Mavi */
        #scoreDisplay { background-color: #e7fff0;
            border: 2px solid #98e3b5; color: #2ecc71; } /* YeÅŸil */
        #timerDisplay { background-color: #fff0e7;
            border: 2px solid #e3a898; color: #e67e22; } /* Turuncu */


        .player-list-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out; 
        }
        .player-list-wrapper.visible {
            max-height: 300px;
            margin-bottom: 25px;
        }

        .player-list { max-height: 250px; overflow-y: auto;
        }
        .player-list button { 
            display: block;
            width: 90%; 
            margin: 10px auto; 
            padding: 14px; 
            background-color: #4BB778; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 19px;
            transition: background-color 0.3s, transform 0.1s; 
        }
        .player-list button:hover { background-color: #3e9e67; transform: translateY(-2px);
        }

        .container button {
            transition: all 0.3s ease;
        }

        #togglePlayerListBtn {
            background-color: #3498db !important;
            color: white;
            padding: 16px 35px;
            font-size: 1.3em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.4);
        }
        #togglePlayerListBtn:hover {
            background-color: #2980b9 !important;
            box-shadow: 0 6px 8px rgba(52, 152, 219, 0.5);
        }
        #togglePlayerListBtn.clicked { 
             background-color: #e74c3c !important;
            box-shadow: 0 4px 6px rgba(231, 76, 60, 0.4);
        }

        #highScores { margin-top: 35px;
            border-top: 2px solid #e0e0e0; padding-top: 20px; }
        #highScores h3 { color: #334455;
        }
        .score-item { 
            display: flex;
            justify-content: space-between; 
            padding: 10px 15px; 
            margin-bottom: 5px;
            background-color: #fcfcfc;
            border-radius: 8px;
            border: 1px solid #eee;
            font-weight: 400;
        }

        .score-item > span:last-child {
            display: flex;
            align-items: center;
        }
        
        /* ################# Ä°ÅLEM ALANI STÄ°LLERÄ° (DAHA SIKIÅTIRILDI) ################# */

        .operation-container {
            display: grid;
            /* YATAY KONUM: Ä°ÅŸaret iÃ§in 30px, SayÄ±lar iÃ§in 140px */
            grid-template-columns: 30px 140px; 
            justify-content: center;
            align-items: center;
            font-size: 3.2em; /* DAHA DA KÃœÃ‡ÃœLTÃœLDÃœ (3.5em yerine 3.2em) */
            font-weight: 600;
            margin: 15px 0 10px 0; /* Dikey boÅŸluklar DAHA DA daraltÄ±ldÄ± */
            min-height: 140px; /* KÃœÃ‡ÃœLTÃœLDÃœ (150px yerine 140px) */
        }

        #currentOperationGrid {
            grid-column: 2; 
            display: flex;
            flex-direction: column;
            align-items: flex-end; 
        }

        .op-number {
            line-height: 0.95; /* DAHA DA DARALTILDI */
            padding-right: 8px;
            color: #2c3e50;
        }

        .op-line-separator {
            grid-column: 1 / span 2; 
            width: 100%;
            border-bottom: 2px solid #334455; /* Ã‡izgi kalÄ±nlÄ±ÄŸÄ± azaltÄ±ldÄ± */
            margin-top: 5px; 
        }

        #opPlusContainer {
            grid-column: 1; 
            line-height: 1; 
            align-self: end; 
            padding-bottom: 5px; /* Alt boÅŸluk azaltÄ±ldÄ± */
            font-size: 1em; 
            color: #3498db; 
        }

        /* ################# SONUÃ‡ BÃ–LGESÄ° STÄ°LLERÄ° (DAHA SIKIÅTIRILDI) ################# */

        .result-zone { 
            display: flex; 
            justify-content: center; 
            margin-top: 10px; /* Ãœst boÅŸluk minimalize edildi */
            margin-bottom: 15px; /* Alt boÅŸluk minimalize edildi */
        }
        
        .result-digit { 
            width: 60px; /* DAHA DA KÃœÃ‡ÃœLTÃœLDÃœ (65px yerine 60px) */
            height: 70px; /* DAHA DA KÃœÃ‡ÃœLTÃœLDÃœ (80px yerine 70px) */
            border: 2px dashed #aebcce; /* Ã‡izgi kalÄ±nlÄ±ÄŸÄ± azaltÄ±ldÄ± */
            margin: 0 8px; /* Yatay boÅŸluk azaltÄ±ldÄ± */
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 2.8em; /* DAHA DA KÃœÃ‡ÃœLTÃœLDÃœ (3em yerine 2.8em) */
            color: #334455; 
            background-color: #fcfcfc; 
            border-radius: 8px; /* Radius azaltÄ±ldÄ± */
            transition: all 0.2s; 
        }
        .result-digit:hover {
            background-color: #f0f0f0;
            border-color: #3498db;
        }
        
        /* ################# SONUÃ‡ BÃ–LGESÄ° STÄ°LLERÄ° BÄ°TÄ°Å ################# */

        /* YENÄ°: Palet artÄ±k iki satÄ±rlÄ± ve gap ayarÄ± buradan yÃ¶netiliyor (DAHA SIKIÅTIRILDI) */
        .number-palette { 
            display: flex; 
            justify-content: center; 
            gap: 6px; /* Rakamlar arasÄ± boÅŸluk daraltÄ±ldÄ± */
            padding: 4px 0; /* Ãœst/alt satÄ±rlar arasÄ±nda boÅŸluk daraltÄ±ldÄ± */
            border-top: 2px solid #e0e0e0; /* Ã‡izgi kalÄ±nlÄ±ÄŸÄ± azaltÄ±ldÄ± */
        }
        
        /* SayÄ± butonlarÄ±nÄ±n varsayÄ±lan boyutu (50px) korunuyor */
        .draggable-number { 
            width: 50px;
            height: 50px; 
            line-height: 50px; 
            border-radius: 50%; 
            font-size: 1.8em; 
            font-weight: 600; 
            cursor: grab; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
            color: white; /* RakamlarÄ±n rengi beyaz olmalÄ± */
        }
        .draggable-number:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
        }

        /* YENÄ°: Sadece Ã¼st paletin Ã¼stÃ¼nde Ã§izgi olsun */
        .top-row {
             border-top: 2px solid #e0e0e0; /* Ã‡izgi kalÄ±nlÄ±ÄŸÄ± azaltÄ±ldÄ± */
        }
        .bottom-row {
             border-top: none;
             /* Alt satÄ±rÄ±n Ã¼stÃ¼nde Ã§izgi olmasÄ±n */
        }

        /* Renk Paleti (0'dan 9'a) */
        .c0 { background-color: #8D33FF;
        } 
        .c1 { background-color: #FF5733;
        } 
        .c2 { background-color: #FFC300;
        } 
        .c3 { background-color: #33FF57;
        } 
        .c4 { background-color: #3357FF;
        } 
        .c5 { background-color: #FF33A1;
        } 
        .c6 { background-color: #33FFF6;
        } 
        .c7 { background-color: #FF8333;
        } 
        .c8 { background-color: #A1A1A1;
        } 
        .c9 { background-color: #990099;
        } 

        #feedback { 
            min-height: 30px; 
            font-size: 1.4em; 
            font-weight: 700; 
            margin: 10px 0; /* Dikey boÅŸluk DAHA AZALTILDI (15px yerine 10px) */
        }
        
        /* ################# KONFETI STÄ°LÄ° ################# */
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 20px;
            background: #ff0; 
            opacity: 0;
            animation: confetti-fall 3s linear forwards;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(0) rotateZ(0);
            opacity: 1; }
            100% { transform: translateY(100vh) rotateZ(720deg);
            opacity: 0; }
        }
/* ################# Ã–ZEL MOBÄ°L UYUMLULUK (MEDIA QUERY) (SIKIÅTIRILDI) ################# */
        /* Ekran geniÅŸliÄŸi 450 piksel ve altÄ± iÃ§in kÃ¼Ã§Ã¼ltme */
        @media (max-width: 450px) {
            
            .container {
                padding: 15px 5px;
            }
            body {
                padding: 10px;
            }

            .header-item {
                font-size: 0.8em;
                padding: 5px 2px;
            }

            .result-digit { 
                width: 45px; 
                height: 55px;
                font-size: 1.8em;
                margin: 0 4px;
            }

            /* Rakamlar arasÄ± boÅŸluk ve padding daraltÄ±ldÄ± */
            .number-palette { 
                gap: 4px; 
                padding: 4px 0;
            }
            
            /* RakamlarÄ±n boyutunu kÃ¼Ã§Ã¼lt */
            .draggable-number { 
                width: 38px; 
                height: 38px; 
                line-height: 38px; 
                font-size: 1.4em; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div id="splashScreen" class="screen active">
            <h2>Eldesiz Toplama MacerasÄ±</h2>
            <p style="font-size: 1.1em; color: #555;">Oyuna baÅŸlamak iÃ§in adÄ±nÄ±zÄ± seÃ§in ve bireysel ÅŸifrenizi girin.</p>

            <button id="togglePlayerListBtn" onclick="togglePlayerList()">AdÄ±nÄ±zÄ± SeÃ§in</button>
     
            <div class="player-list-wrapper" id="playerListWrapper">
                <div class="player-list" id="playerListContainer">
                    </div>
            </div>

            <button onclick="clearAllScoresWithPassword()" style="
               
                background-color: #e74c3c; 
                color: white;
                padding: 12px 25px;
                font-size: 1em;
                border: none;
                border-radius: 10px;
           
                cursor: pointer;
                margin-top: 20px;
                box-shadow: 0 3px 5px rgba(231, 76, 60, 0.3);
            ">TÃ¼m SkorlarÄ± Sil (YÃ¶netici)</button>
            
            <div id="highScores">
                <h3>ğŸ† En Ä°yi Skorlar</h3>
            </div>
        </div>

        <div id="gameScreen" class="screen">
            <div class="header">
          
                <span id="playerNameDisplay" class="header-item">Oyuncu: -</span>
                <span id="scoreDisplay" class="header-item">Puan: 0</span>
                <span id="timerDisplay" class="header-item">SÃ¼re: 120</span>
            </div>

            <div class="operation-container">
                <div id="opPlusContainer"></div> 
          
                <div id="currentOperationGrid"></div>
                <div class="op-line-separator"></div> 
            </div>

            <div class="result-zone">
                <div class="result-digit" data-place="tens" ondrop="drop(event, this)" ondragover="allowDrop(event)">?</div>
                <div class="result-digit" data-place="ones" ondrop="drop(event, this)" ondragover="allowDrop(event)">?</div>
        
            </div>
            
            <div id="feedback"></div>

            <div class="number-palette top-row" id="numberPaletteTop"></div>
            <div class="number-palette bottom-row" id="numberPaletteBottom"></div>
        </div>

        <div id="gameOverScreen" class="screen">
            <h2>Oyun Bitti!</h2>
          
            <p id="finalScoreText" style="font-size: 1.2em; font-weight: 600; color: #34495e;"></p>
            <button onclick="window.location.reload()" style="
                background-color: #2ecc71;
                color: white;
                padding: 15px 30px;
                font-size: 1.2em;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                margin-top: 15px;
                box-shadow: 0 4px 6px rgba(46, 204, 113, 0.4);
            ">Yeniden BaÅŸla</button>
        </div>

    </div>

    <script>
        // ------------------ JAVASCRIPT KODLARI ------------------
        
        // YÃ–NETÄ°CÄ° ÅÄ°FRESÄ°
        const ADMIN_PASSWORD = "ogretmen2024"; 
        const GAME_DURATION = 120; 

        // ################## Ã–ÄRENCÄ° ADLARI VE ÅÄ°FRELERÄ° ##################
       
        const STUDENT_PASSWORDS = {
            "AHMET EFE AYVAZ": "4910",
            "ALÄ° ARAS AYYILDIZ": "5335",
            "ALÄ° ASAF GÃœRBÃœZ": "4771",
            "ALYA DEMÄ°RAL": "2041",
            "ASEL LENA AYYILDIZ": "2441",
            "ASIM MÄ°RAÃ‡ KARA": "2766",
       
            "AYBÃœKE Ã–ZKAN": "4850",
            "BERAT ALÄ° AKDEMÄ°R": "2532",
            "BETÃœL SENA GÃœNGÃ–R": "2274",
            "DERÄ°N DURU Ã‡AL": "5010",
            "DÄ°DEM SOYLU": "4207",
            "EMÄ°R RÃœZGAR GÃ–LEÅ": "5822",
            "ESÄ°LA YÄ°ÄÄ°T": "2644",
     
            "EYMEN ARAS PULATKAN": "1722",
            "EYMEN YAYLACIK": "2425",
            "FATMA HÄ°RA ASLAN": "2310",
            "FEYZA EMÄ°NE ALTUN": "5142",
            "HAMZA KAÄAN Ã–ZTAÅ": "2486",
            "HATÄ°CE Ã‡ALÄ°MLÄ°": "1352",
            "HELÄ°N ADA": "2661",
   
            "HÃœSNE SERRA CEREN": "5303",
            "Ä°MRAN YAZICI": "2832",
            "MÄ°RAÃ‡ Ã–ZÃ‡ELEBÄ°": "3552",
            "MUSAB CÄ°HAT KILIÃ‡": "2841",
            "NÄ°SANUR FÄ°LÄ°Z": "1234",
            "Ã–MER ASAF GÃœNGÃ–R": "2274",
            "SAÄ°D HAMZA ASLAN": "2272",
 
            "SÄ°NAN BARAN": "4840",
            "TUANA TÃœRK DERÄ°N Ã‡ETÄ°N": "1961",
            "UMUT ARAS KUTLU": "2216",
            "YÄ°ÄÄ°T ALÄ° BENLÄ°": "2559",
            "YÄ°ÄÄ°T ASAF Ä°ÅSEVER": "4888",
            "YUSUF BERAT TANRIVERDÄ°": "4682",
           
            "YUSUF BOZDOÄAN": "4810",
            "YUSUF EYMEN Ã‡INAR": "5046",
            "ZEYNEB MERYEM TAHÄ°ROÄLU": "4422",
            "ZEYNEP AKSOY": "2414",
            "ZÃœMRA BELÄ°Z YILDIRIM": "4949"
        };
        // ###############################################################

        const STUDENT_NAMES = Object.keys(STUDENT_PASSWORDS);
        const INITIAL_PLAYERS = [...STUDENT_NAMES, "Ã–ÄŸretmen"];
        const generateUniqueId = () => Date.now().toString(36) + Math.random().toString(36).substring(2);

        let currentScore = 0;
        let timeLeft = GAME_DURATION;
        let timerInterval;
        let currentPlayer = null;
        let currentAnswer = null;
        let resultDigits = { ones: null, tens: null };
        const splashScreen = document.getElementById('splashScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const playerListContainer = document.getElementById('playerListContainer');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const feedbackDisplay = document.getElementById('feedback');
        
        const opPlusContainer = document.getElementById('opPlusContainer');
        const currentOperationGrid = document.getElementById('currentOperationGrid');
        const playerListWrapper = document.getElementById('playerListWrapper');
        const numberPalette = document.getElementById('numberPalette');
        const resultDigitsElements = document.querySelectorAll('.result-digit');
        
        let currentDragElement = null;
        // ------------------ LOCAL STORAGE YÃ–NETÄ°MÄ° ------------------
        function getHighScores() {
            try {
                const scores = JSON.parse(localStorage.getItem('toplamaScores'));
                return Array.isArray(scores) ? scores : [];
            } catch (e) { return [];
            }
        }

        function saveScore(player, score) {
            const scores = getHighScores();
            const newScoreEntry = { 
                id: generateUniqueId(),
                player: player, 
                score: score 
            };
            scores.push(newScoreEntry);
            
            scores.sort((a, b) => b.score - a.score); 
            
            localStorage.setItem('toplamaScores', JSON.stringify(scores));
            renderHighScores();
        }

        // ------------------ SKOR SÄ°LME FONKSÄ°YONLARI ------------------
        
        function deleteSingleScoreWithPassword(scoreId, playerName) {
            const enteredPassword = prompt(`${playerName} oyuncusunun kaydÄ±nÄ± silmek iÃ§in YÃ–NETÄ°CÄ° ÅŸifresini girin:`);
            if (enteredPassword === ADMIN_PASSWORD) {
                let scores = getHighScores();
                const updatedScores = scores.filter(s => 
                    s.id !== scoreId 
                );
                localStorage.setItem('toplamaScores', JSON.stringify(updatedScores));
                renderHighScores();
                alert(`${playerName} oyuncusunun kaydÄ± silindi.`);

            } else if (enteredPassword !== null) {
                alert('Hata! Girilen ÅŸifre yanlÄ±ÅŸ.');
            }
        }
        
        function clearAllScoresWithPassword() {
            const enteredPassword = prompt("TÃ¼m SkorlarÄ± Silmek Ä°Ã§in YÃ–NETÄ°CÄ° ÅŸifresini girin:");
            if (enteredPassword === ADMIN_PASSWORD) {
                localStorage.removeItem('toplamaScores');
                renderHighScores();
                alert('Tebrikler! TÃ¼m Skorlar BaÅŸarÄ±yla SÄ±fÄ±rlandÄ±.');
            } else if (enteredPassword !== null) {
                alert('Hata! Girilen ÅŸifre yanlÄ±ÅŸ.');
            }
        }
        
        // ------------------ OYUN AKIÅI FONKSÄ°YONLARI ------------------

        function togglePlayerList() {
            playerListWrapper.classList.toggle('visible');
            const btn = document.getElementById('togglePlayerListBtn');
            
            if (playerListWrapper.classList.contains('visible')) {
                btn.textContent = 'Listeyi Gizle';
                btn.classList.add('clicked'); 
            } else {
                btn.textContent = 'AdÄ±nÄ±zÄ± SeÃ§in';
                btn.classList.remove('clicked'); 
            }
        }
        
        function checkPasswordAndStartGame(player) {
            let requiredPassword = null;
            if (player === "Ã–ÄŸretmen") {
                requiredPassword = ADMIN_PASSWORD;
            } else if (STUDENT_PASSWORDS[player]) {
                requiredPassword = STUDENT_PASSWORDS[player];
            } else {
                alert('Hata: Oyuncu kaydÄ± bulunamadÄ±.');
                return; 
            }

            const enteredPassword = prompt(`${player} adÄ±yla baÅŸlamak iÃ§in ÅŸifrenizi girin:`);
            if (enteredPassword === null) {
                return;
            }
            
            if (enteredPassword === requiredPassword) {
                startGame(player);
            } else {
                alert('Hata: Girilen ÅŸifre yanlÄ±ÅŸ. LÃ¼tfen tekrar deneyin.');
            }
        }

        function startGame(player) {
            currentPlayer = player;
            currentScore = 0;
            timeLeft = GAME_DURATION;
            splashScreen.classList.remove('active');
            gameScreen.classList.add('active');
            document.getElementById('playerNameDisplay').textContent = `ğŸ‘¤ Oyuncu: ${currentPlayer}`;
            updateDisplay();
            generateNewOperation();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `â³ SÃ¼re: ${timeLeft}`;
                if (timeLeft <= 0) {
                  
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            gameScreen.classList.remove('active');
            gameOverScreen.classList.add('active');
            clearInterval(timerInterval);
            document.getElementById('finalScoreText').textContent = `${currentPlayer}, Toplam PuanÄ±n: ${currentScore}`;
            saveScore(currentPlayer, currentScore);
        }

        function updateDisplay() {
            scoreDisplay.textContent = `â­ Puan: ${currentScore}`;
        }

        function generateRandomNonCarrying() {
            let numbers = [];
            let numCount = Math.random() < 0.5 ? 2 : 3;
            let sumOnes = 0;
            let sumTens = 0;
            for (let i = 0; i < numCount; i++) {
                let ones, tens;
                ones = Math.floor(Math.random() * (10 - sumOnes));
                sumOnes += ones;
                tens = Math.floor(Math.random() * (10 - sumTens));
                sumTens += tens;
                numbers.push(tens * 10 + ones);
            }
            
            if (numbers.every(n => n === 0)) return generateRandomNonCarrying();
            if (sumTens === 0 && sumOnes < 5) {
                 return generateRandomNonCarrying();
            }

            currentAnswer = sumTens * 10 + sumOnes;
            return { numbers: numbers, sum: currentAnswer };
        }

        function generateNewOperation() {
            const operationData = generateRandomNonCarrying();
            const numbers = operationData.numbers;
            currentAnswer = operationData.sum;
            
            let numHTML = '';
            numbers.forEach(num => {
                numHTML += `<div class="op-number">${num}</div>`;
            });
            currentOperationGrid.innerHTML = numHTML;

            opPlusContainer.innerHTML = '+';

            resultDigitsElements.forEach(el => {
                el.textContent = '?';
                el.className = 'result-digit';
            });
            resultDigits = { ones: null, tens: null };
            feedbackDisplay.textContent = '';
        }
        
        const confettiColors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
        function launchConfetti() {
            const pieces = 50;
            for (let i = 0; i < pieces; i++) {
                const piece = document.createElement('div');
                piece.classList.add('confetti-piece');
                
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.top = Math.random() * 50 + '%';
                
                piece.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                piece.style.width = Math.random() * 10 + 5 + 'px';
                piece.style.height = Math.random() * 20 + 10 + 'px';
                piece.style.animationDuration = (Math.random() * 2 + 1) + 's';
                
                document.body.appendChild(piece);
                piece.addEventListener('animationend', () => {
                    piece.remove();
                });
            }
        }

        function allowDrop(ev) { ev.preventDefault();
        }
        function drag(ev) { ev.dataTransfer.setData("value", ev.target.getAttribute('data-value')); ev.dataTransfer.setData("color", ev.target.getAttribute('data-color-class'));
        }
        function drop(ev, targetElement) {
            ev.preventDefault();
            const value = ev.dataTransfer.getData("value");
            const colorClass = ev.dataTransfer.getData("color");
            if (value && colorClass) { handleDrop(targetElement, value, colorClass);
            }
        }
        
        function touchStart(ev) {
            if (ev.touches.length === 1 && ev.target.classList.contains('draggable-number')) {
                currentDragElement = ev.target;
                currentDragElement.style.position = 'absolute';
                currentDragElement.style.zIndex = '1000';
                touchMove(ev); 
            }
        }

        function touchMove(ev) {
            if (currentDragElement) {
                ev.preventDefault();
                const touch = ev.touches[0];
                currentDragElement.style.left = touch.clientX - (currentDragElement.offsetWidth / 2) + 'px';
                currentDragElement.style.top = touch.clientY - (currentDragElement.offsetHeight / 2) + 'px';
            }
        }

        function touchEnd(ev) {
            if (currentDragElement) {
                ev.preventDefault();
                const touch = ev.changedTouches[0];
                
                // 1. SÃ¼rÃ¼klenen elementi geÃ§ici olarak gizle
                currentDragElement.style.display = 'none';
                // 2. Gizlenen elementin altÄ±ndaki hedefi bul
                const target = document.elementFromPoint(touch.clientX, touch.clientY);
                // 3. SÃ¼rÃ¼klenen elementi tekrar gÃ¶ster
                currentDragElement.style.display = 'block';
                // 4. Hedef bir sonuÃ§ hanesi mi kontrol et (result-digit) ve bÄ±rakma iÅŸlemini gerÃ§ekleÅŸtir
                if (target && target.classList.contains('result-digit')) {
                    handleDrop(target, currentDragElement.getAttribute('data-value'), currentDragElement.getAttribute('data-color-class'));
                }

                // Stilleri sÄ±fÄ±rla ve dragging iÅŸlemini bitir
                currentDragElement.style.position = 'relative';
                currentDragElement.style.left = '0';
                currentDragElement.style.top = '0';
                currentDragElement.style.zIndex = '1';
                currentDragElement = null;
            }
        }
        
        function handleDrop(targetElement, value, colorClass) {
            const place = targetElement.getAttribute('data-place');
            targetElement.textContent = value;
            targetElement.className = `result-digit ${colorClass}`;
            resultDigits[place] = parseInt(value);
            checkAnswer();
        }

        function checkAnswer() {
            const { ones, tens } = resultDigits;
            if (currentAnswer <= 9) {
                if (ones !== null) {
                    if (ones === currentAnswer) {
                        handleCorrectAnswer();
                        return;
                    } else if (tens !== null && (tens !== 0 || currentAnswer !== ones)) {
                        handleWrongAnswer();
                        return;
                    }
                }
            } 
            else {
                if (ones !== null && tens !== null) {
                    const guessedAnswer = (tens * 10) + ones;
                    if (guessedAnswer === currentAnswer) {
                        handleCorrectAnswer();
                    } else {
                        handleWrongAnswer();
                    }
                }
            }
        }

        function handleCorrectAnswer() {
            currentScore++;
            updateDisplay();
            launchConfetti(); 
            feedbackDisplay.style.color = '#2ecc71'; 
            feedbackDisplay.textContent = 'Aferin! ğŸŒŸ Yeni Ä°ÅŸlem Geliyor...';
            setTimeout(() => { generateNewOperation(); }, 1500);
        }

        function handleWrongAnswer() {
            feedbackDisplay.style.color = '#e74c3c';
            feedbackDisplay.textContent = 'YanlÄ±ÅŸ yaptÄ±n, yeniden dene. ğŸ¤”';
            resultDigitsElements.forEach(el => {
                el.textContent = '?';
                el.className = 'result-digit';
            });
            resultDigits = { ones: null, tens: null };
        }

        // ------------------ Ä°LK YÃœKLEME VE RENDER ------------------
        
        function renderPlayerList() {
            const scores = getHighScores();
            let players = [...new Set([...INITIAL_PLAYERS, ...scores.map(s => s.player)])]; 
            
            if (playerListContainer) {
                playerListContainer.innerHTML = players.map(name => 
                    `<button onclick="checkPasswordAndStartGame('${name}')">${name}</button>`
                ).join('');
            }
        }

        function renderHighScores() {
            const scores = getHighScores();
            const scoreHtml = scores.map((s, index) => {
                const deleteButton = `
                    <button 
                        onclick="deleteSingleScoreWithPassword('${s.id}', '${s.player}')" 
                        style="background: #e74c3c; color: white; 
                        border: none; border-radius: 6px; padding: 4px 8px; margin-left: 12px; cursor: pointer; font-size: 0.9em; line-height: 1.2;">
                        ğŸ—‘ï¸ Sil
                    </button>`;

                return `<div class="score-item">
                       
                        <span>${index + 1}. ${s.player}</span>
                            <span>${s.score}${deleteButton}</span>
                        </div>`;
            }).join('');
            document.getElementById('highScores').innerHTML = `
                <h3>ğŸ† En Ä°yi Skorlar</h3>
                ${scoreHtml ||
                '<p style="margin-top: 15px; color: #777;">HenÃ¼z skor yok. Ä°lk sen oyna!</p>'}
            `;
        }
        
        function renderNumberPalette() {
            let htmlTop = '';
            let htmlBottom = '';
            const colorClasses = ['c0', 'c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9'];
            for (let i = 0; i <= 9; i++) {
                const numberHtml = `
                    <div 
                        class="draggable-number ${colorClasses[i]}" 
                        draggable="true" 
 
                        data-value="${i}" 
                        data-color-class="${colorClasses[i]}"
                        ondragstart="drag(event)"
                        ondragover="allowDrop(event)"
   
                        ondrop="drop(event, this)"
                        ontouchstart="touchStart(event)"
                        ontouchmove="touchMove(event)"
                        ontouchend="touchEnd(event)">
      
                        ${i}
                    </div>
                `;
                // 0'dan 4'e Ã¼st satÄ±r
                if (i <= 4) {
                    htmlTop += numberHtml;
                } 
                // 5'ten 9'a alt satÄ±r
                else {
                    htmlBottom += numberHtml;
                }
            }
            
            // Yeni ID'lere yerleÅŸtirme
            const numberPaletteTop = document.getElementById('numberPaletteTop');
            const numberPaletteBottom = document.getElementById('numberPaletteBottom');

            if (numberPaletteTop) {
                numberPaletteTop.innerHTML = htmlTop;
            }
            if (numberPaletteBottom) {
                numberPaletteBottom.innerHTML = htmlBottom;
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            renderPlayerList();
            renderHighScores();
            renderNumberPalette();
            splashScreen.classList.add('active'); 
        });
    </script>
</body>

</html>
